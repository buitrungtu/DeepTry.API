-- bttu - Tạo proc thêm tài khoản, công ty, chi nhánh (29.6.2021)
CREATE PROCEDURE dbo.Proc_InsertAccount(
	@account_name varchar(50), @password varchar(50), @is_admin int, 
	@company_id uniqueidentifier, @branch_id uniqueidentifier)
as
begin
	IF not EXISTS (SELECT 1 FROM dbo.account WHERE account_name = @account_name)
	begin
		insert into dbo.account(account_name, password, is_admin, company_id, branch_id) 
		values (@account_name, @password, @is_admin, @company_id, @branch_id);
	end
end;

go

CREATE PROCEDURE dbo.Proc_InsertCompany(
	@company_code text, @company_name text, @branch_code text, @branch_name text  
)
as
begin
	declare @company_id uniqueidentifier;
	set @company_id = newid();
	insert into dbo.company(company_id, company_code, company_name) 
	values (@company_id, @company_code, @company_name);
	insert into dbo.branch(branch_code, branch_name, is_parent, company_id) 
	values (@branch_code, @branch_name, 0, @company_id);
end;
go;

CREATE PROCEDURE dbo.Proc_InsertBranch(
	@branch_code varchar(50), @branch_name nvarchar(255), @company_id uniqueidentifier
)
as begin
	IF not EXISTS (SELECT 1 FROM dbo.branch WHERE branch_name = @branch_name)
	begin
		insert into dbo.branch(branch_code, branch_name, is_parent, company_id) 
		values (@branch_code, @branch_name, 1, @company_id);
	end
end;